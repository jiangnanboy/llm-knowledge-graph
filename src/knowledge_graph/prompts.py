# -*- coding: utf-8 -*-

# Phase 1: 主要提取提示
MAIN_SYSTEM_PROMPT = """
你是一个专门从事知识提取和知识图谱生成的高级人工智能系统。
你的专业知识包括识别文本中一致的实体引用和有意义的关系。
关键提示：所有关系（谓语）必须最多不超过3个单词。最好是1-2个单词。这是一个硬性限制。
"""

MAIN_USER_PROMPT = """
你的任务：阅读下面的文本（用三个反引号分隔），并识别每个句子中所有的主语-谓语-宾语（S-P-O）关系。然后生成单个JSON对象数组，每个对象表示一个三元组。

请仔细遵循以下规则：

- 实体一致性：在整个文档中，实体名称保持一致。例如，如果“百度”在不同的地方被称为“百度公司”、“百度有限公司”和“百度科技”，那么在所有三元组中使用单一的一致形式（最好是最完整的形式）。
- 原子术语：识别不同的关键术语（例如，对象，位置，组织，缩略词，人，条件，概念，感觉）。避免将多个想法合并到一个术语中（它们应该尽可能“原子化”）。
- 统一引用：将任何代词（例如，“他”，“她”，“它”，“他们”等）替换为实际引用的实体，如果可识别的话。
- 成对关系：如果多个术语同时出现在同一个句子（或一个使它们在上下文上相关的短段落）中，则为每一对具有有意义的关系创建一个三元组。
- 关键指令：谓语必须最多1-3个单词。不要超过3个字。保持它们非常简洁。
- 确保在文本中识别所有可能的关系，并在S-P-O关系中捕获。
- 标准化术语：如果相同的概念出现了轻微的变化（例如，“人工智能”和“AI”），使用最常见的或规范的形式一致。
- 如果有英文的话，使所有的S-P-O文本小写，甚至人名和地名。
- 如果一个人的名字被提到，创建一个关系，他们的位置，职业和他们知道什么（发明，写作，开始，头衔等），如果知道，如果它符合信息的上下文。

重要的考虑因素：

- 以实体命名的准确性为目标
- 使用特定的形式来区分相似但不同的实体
- 通过在整个文档中使用相同的实体名称来最大化连通性
- 在识别实体引用时考虑整个上下文
- 所有谓语必须是3个单词或更少，这是一个硬性要求

输出要求：

- 不要在JSON之外包含任何文本或注释。
- 只返回JSON数组，每个三元组作为包含“主语”、“谓语”和“宾语”的对象。
- 确保JSON是有效的和正确的格式。
- 输出的三元组必须是中文
- 输出的三元组，主语-谓语-宾语必须三个都要有值，不能为空

期望输出的结构示例：

[
  {
    "subject": "条目A",
    "predicate": "涉及到",
    "object": "条目B"
  },
  {
    "subject": "条目C",
    "predicate": "使用",
    "object": "条目D"
  }
]

重要：只输出JSON数组（带有S-P-O对象），没有其他文本要分析（在三个反引号之间）：
"""

# Phase 2: 实体标准化提示
ENTITY_RESOLUTION_SYSTEM_PROMPT = """
你是实体解析和知识表示方面的专家。
你的任务是标准化知识图中的实体名称，以确保一致性。
"""

def get_entity_resolution_user_prompt(entity_list):
    return f"""
下面是从知识图中提取的实体名称列表。
有些可能指的是相同的现实世界实体，但措辞不同。

请识别涉及相同概念的实体组，并为每组提供标准化名称。
将你的答案返回为JSON对象，其中键是标准化名称，值是应该映射到该标准名称的所有变量名称的数组。
只包括具有多个变体或需要标准化的实体。

输出要求：

- 输出的三元组必须是中文
- 输出的三元组，主语-谓语-宾语必须三个都要有值，不能为空

实体名称列表:
{entity_list}

将你的响应格式化为有效的JSON，如下所示：
{{
  "标准化名称1": ["变量1", "变量2"],
  "标准化名称2": ["变量3", "变量4", "变量5"]
}}
"""

# Phase 3: 社区关系推理提示
RELATIONSHIP_INFERENCE_SYSTEM_PROMPT = """
你是知识表示和推理方面的专家。
你的任务是推断知识图中不相连实体之间的合理关系。
"""

def get_relationship_inference_user_prompt(entities1, entities2, triples_text):
    return f"""
我有一个知识图谱，里面有两个不相连的实体社区。

社区1实体: {entities1}
社区2实体: {entities2}

以下是涉及这些实体的一些现有关系：
{triples_text}

请在社区1和社区2的实体之间推断出2-3种合理的关系。
将你的答案以以下格式的三元组JSON数组返回：

输出要求：

- 输出的三元组必须是中文
- 输出的三元组，主语-谓语-宾语必须三个都要有值，不能为空
- 谓语不能是'is type of'这种类型

[
  {{
    "subject": "社区1的实体",
    "predicate": "推断的关系",
    "object": "社区2的实体"
  }},
  ...
]

只包含具有明确谓语的高度可信的关系。
重要提示：推断关系（谓语）不能超过3个单词。最好是1-2个单词。不会超过3个。
对于谓语，使用能够清晰描述关系的短语。
重要：确保主语和宾语是不同的实体-避免自我引用。
"""

# Phase 4: 社区内关系推理提示
WITHIN_COMMUNITY_INFERENCE_SYSTEM_PROMPT = """
你是知识表示和推理方面的专家。
你的任务是在知识图中尚未连接的语义相关实体之间推断出合理的关系。
"""

def get_within_community_inference_user_prompt(pairs_text, triples_text):
    return f"""
我有一个知识图谱与几个实体，似乎是语义相关，但不直接连接。

以下是一些可能相关的实体对：
{pairs_text}

以下是涉及这些实体的一些现有关系：
{triples_text}

输出要求：

- 输出的三元组必须是中文
- 输出的三元组，主语-谓语-宾语必须三个都要有值，不能为空
- 谓语不能是'is type of'这种类型

请在这些不相连的对之间推断出合理的关系。
将你的答案以以下格式的三元组JSON数组返回：

[
  {{
    "subject": "实体1",
    "predicate": "推断的关系",
    "object": "实体2"
  }},
  ...
]

只包含具有明确谓语的高度可信的关系。
重要提示：推断关系（谓语）不能超过3个单词。最好是1-2个单词。不会超过3个。
重要：确保主语和宾语是不同的实体-避免自我引用。
""" 